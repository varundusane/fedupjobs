<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <title>FEDUP.JOBS</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <style>
        .nav-item:hover{
            background-color: skyblue;
            
            border-radius: 5px;
        }
        .nav-item:hover > a{
            color: white !important;
        }
    </style>
    
</head>

<body>
    <div class="mobileNav" data-behavior="toggle-headNav">
        <div class="logo">fedup.jobs</div>
    </div>
    <nav class="headerNav">
        <ul class="nav">
            <li class="nav-item">
                <a class="nav-link active" href="/">
                    <img src="img/fedup logo.jpg" data-visited="true" />
                </a>
            </li>
        </ul>
        <ul class="navjustify-content-center">
            <li class="nav-item">
                <a class="nav-link active" href="/">jobs</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/startup">startup</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " href="/tags">tags</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/location">location</a>
            </li>
        </ul>
        <ul class="navjustify-content-end">
            <li class="nav-item">
                <a class="btn btn-active btn-primary" href="/addNewPost/">post your job</a>
            </li>
    </nav>
    <section class="content-wrapper">
        <div class="content">
            
            <div class="searchForm" data-behavior="search" data-controller="search-form"
                data-search-form-since-filter="1607147442">
                <div class="searchForm__box">
                    <div class="searchForm__section searchForm__section--primary">
                        <div class="searchForm__section__label">What job are you looking for?</div>
                        <div class="searchForm__section__input">
                            <div id="foobar">
                                <div class="ais-SearchBox">
                                    <form action="" role="search" class="ais-SearchBox-form" novalidate="">
                                        <input class="ais-SearchBox-input searchField__input" id="title" type="search"
                                            placeholder="Search for job title, skills, startupsâ€¦" autofocus="true"
                                            autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                                            maxlength="512">
                                        <button class="ais-SearchBox-submit" type="submit"
                                            title="Submit the search query." hidden="">
                                            <svg class="ais-SearchBox-submitIcon" xmlns="http://www.w3.org/2000/svg"
                                                width="10" height="10" viewBox="0 0 40 40">
                                                <path
                                                    d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z">

                                                </path>
                                            </svg>
                                        </button>
                                        <span class="ais-SearchBox-loadingIndicator" hidden="">
                                            <svg class="ais-SearchBox-loadingIcon" width="16" height="16"
                                                viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#444">
                                                <g fill="none" fillrule="evenodd">
                                                    <g transform="translate(1 1)" strokewidth="2">
                                                        <circle strokeopacity=".5" cx="18" cy="18" r="18">

                                                        </circle>
                                                        <path d="M36 18c0-9.94-8.06-18-18-18">
                                                            <animateTransform attributeName="transform" type="rotate"
                                                                from="0 18 18" to="360 18 18" dur="1s"
                                                                repeatCount="indefinite">

                                                            </animateTransform>
                                                        </path>
                                                    </g>
                                                </g>
                                            </svg>
                                        </span>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="searchForm__section searchForm__section--secondary">
                        <div class="searchForm__section__label">
                            <div id="remote">
                                <div class="ais-ToggleRefinement"><label class="ais-ToggleRefinement-label"><input
                                            class="ais-ToggleRefinement-checkbox" type="checkbox"><span
                                            class="ais-ToggleRefinement-labelText">
                                            <div class="">
                                                <div
                                                    class="searchForm__section__label__toggleOption searchForm__section__label__toggleOption--default">
                                                    Where?</div> or <div
                                                    class="searchForm__section__label__toggleOption">Remote</div>
                                            </div>
                                        </span></label></div>

                            </div>
                        </div>
                        <div class="searchForm__section__input">
                            <div class="autocompleteWrapper">
                                <span class="algolia-autocomplete"
                                    style="position: relative; display: inline-block; direction: ltr;"><input
                                        type="text" name="search-input" id="search-input" value=""
                                        class="form-control col-12" placeholder="Anywhere"
                                        autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list"
                                        aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto"
                                        style="position: relative; vertical-align: top;">
                                    <pre aria-hidden="true"
                                        style="position: absolute; visibility: hidden; white-space: pre; font-family: -apple-system, BlinkMacSystemFont,Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji; font-size: 22.5px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: normal; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre>
                                    <span class="ap-nostyle-dropdown-menu" role="listbox"
                                        id="algolia-autocomplete-listbox-0"
                                        style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;">
                                        <div class="ap-nostyle-dataset-1"></div>
                                        <div class="ap-nostyle-dataset-2"></div>
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="searchForm__section searchForm__section--tertiary">
                        <div class="searchForm__section__input">
                            <div id="commitments">
                                <div class="ais-RefinementList">
                                    <ul class="ais-RefinementList-list">
                                        <li class="ais-RefinementList-item">
                                            <div><label class="ais-RefinementList-label"> <input type="checkbox"
                                                        class="ais-RefinementList-checkbox"id='full_time' name="job_type"
                                                        value="Full-Time"> <span
                                                        class="ais-RefinementList-labelText">Full-Time</span> <span
                                                        class="ais-RefinementList-count">{{ full_time }}</span> </label>
                                            </div>
                                        </li>
                                        <li class="ais-RefinementList-item">
                                            <div><label class="ais-RefinementList-label"> <input type="checkbox"
                                                        class="ais-RefinementList-checkbox" id="part_time" name="job_type"
                                                        value="Part-Time"> <span
                                                        class="ais-RefinementList-labelText">Part-Time</span> <span
                                                        class="ais-RefinementList-count">{{ part_time }}</span> </label>
                                            </div>
                                        </li>
                                        <li class="ais-RefinementList-item">
                                            <div><label class="ais-RefinementList-label"> <input type="checkbox"
                                                        class="ais-RefinementList-checkbox" id="internship" name="job_type"
                                                        value="Internship"> <span
                                                        class="ais-RefinementList-labelText">Internship</span> <span
                                                        class="ais-RefinementList-count">{{ Internship }}</span>
                                                </label></div>
                                        </li>
                                        <li class="ais-RefinementList-item">
                                            <div><label class="ais-RefinementList-label"> <input type="checkbox"
                                                        class="ais-RefinementList-checkbox" id="contractor" name="job_type"
                                                        value="Contractor"> <span
                                                        class="ais-RefinementList-labelText">Contractor</span> <span
                                                        class="ais-RefinementList-count">{{ Contractor }}</span>
                                                </label></div>
                                        </li>
                                    </ul>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <div>
        <section class="content-wrapper">
            <div class="content content--unpadded">
                {% for job in jobs %}
                    <div class="jobCard" data-action="click->clickable#open" data-clickable-target="_blank"
                        data-clickable-url="/art-director-design-at-procore-4" data-controller="clickable">
                        <div class="jobCard__details">
                            <a class="jobCard__details__logo" style="background-image: url('{{ job.company_img_url }}')"
                                href="/@procore">Procore</a>
                            <div class="jobCard__details__ultra">
                                <a data-behavior="track-visited-instantly" class="jobCard__details__title"
                                    href="{% url 'job_details' id=job.id %}">{{ job.job_title }}</a>
                                <div class="jobCard__details__company"><a href="#">{{ job.company_name }}</a></div>
                            </div>
                        </div>
                        <div class="jobCard__tags">
                            {% for key in job.job_keys.all %}
                            <a class="tag" href="{% url 'filtered_keys' job_keys=key.name %}">{{ key.name }}</a>
                            {% endfor %}
                        </div>
                        <div class="jobCard__details__location">
                            {% if job.location %}
                            {{ job.location}}
                            {% endif %}, {% if job.country %}{{job.country}} {% endif %}
                        </div>
                    </div>
                {%endfor%}
            </div>
        </section>
    </div>


<script>
    const company = "{{company_name}}";
    const page_for = "{{ page_for }}"
    let past_html = '';
    $('#title').on('keyup change', searchResult)
    $('#search-input').on('keyup change', searchResult);
    $('#full_time').on('click change', searchResult);
    $('#part_time').on('click change', searchResult);
    $('#internship').on('click change', searchResult);
    $('#contractor').on('click change', searchResult);
    $('.ais-SearchBox-reset').on('click', searchResult);

    let initialObj = {
        'title': $('#title').val(),
        'location': $('#search-input').val(),
        'full_time': $('#full_time').prop('checked'),
        'part_time': $('#part_time').prop('checked'),
        'intern': $('#internship').prop('checked'),
        'contract': $('#contractor').prop('checked')
    }


    function searchResult(){
        if(past_html == ''){
            past_html = $('.content--unpadded').html()
        }

        let title = ($('#title').val()).length >0 ? $('#title').val() : '';
        let location = ($('#search-input').val()).length > 0 ? $('#search-input').val() : '';
        let full_time = $('#full_time').prop('checked');
        let part_time = $('#part_time').prop('checked');
        let intern = $('#internship').prop('checked');
        let contract = $('#contractor').prop('checked');

        if((title=='') && (location == '') && (full_time == initialObj.full_time) && (full_time == initialObj.full_time) && (part_time==initialObj.part_time) && (intern==initialObj.intern)&&(contract==initialObj.contract)){
            $('.content--unpadded').html(past_html);
            return
        }
        let url = "";
        if(page_for == 'company'){

            url = `/api/filteredFromCompanyViewSet?company=${company}&title=${title}&location=${location}&full_time=${full_time}&part_time=${part_time}&interns=${intern}&contract=${contract}`;
        }
        else if(page_for == 'job_keys'){
            url = `/api/filteredForKeysViewSet?keys=${company}&title=${title}&location=${location}&full_time=${full_time}&part_time=${part_time}&interns=${intern}&contract=${contract}`;
        }else if(page_for == 'country'){
            url = `/api/filteredForCountryViewSet?country=${company}&title=${title}&location=${location}&full_time=${full_time}&part_time=${part_time}&interns=${intern}&contract=${contract}`;
        }else if(page_for == 'category'){
            url = `/api/filteredForCategoryViewSet?category=${company}&title=${title}&location=${location}&full_time=${full_time}&part_time=${part_time}&interns=${intern}&contract=${contract}`;
            
        }

        if(url == ""){return}
        $.ajax({
            url: url ,
            method: 'GET',
            contentType: 'application/json'
        }).done(response=>{
            let text = '';
            if(response.length ==0){
                let texts = `<div class="text-center"><p>No jobs. </p></div>`;
                
                $('.content--unpadded').html(texts)
            }
            response.map(index=>{
                let keys = index.job_keys;
                let aTags = '';
                for(var i=0; i<keys.length; i++){
                    aTags += `<a class="tag" href="/jobkey/${keys[i].name}">${keys[i].name}</a>`;
                }
                let locations = '';
                if(index.location != null){
                    locations += index.location
                }
                if(index.country != null){
                    locations += ', '+ index.country
                }
                text += `
                <div class="jobCard" data-action="click->clickable#open" data-clickable-target="_blank"
                            data-clickable-url="/art-director-design-at-procore-4" data-controller="clickable">
                            <div class="jobCard__details">
                                <a class="jobCard__details__logo"
                                    style="background-image: url('${index.company_img_url}')"
                                    href="/@procore">Procore</a>
                                <div class="jobCard__details__ultra">
                                    <a data-behavior="track-visited-instantly" class="jobCard__details__title"
                                        href="/job/${index.id}">${index.job_title}</a>
                                    <div class="jobCard__details__company"><a href="#">${index.company_name}</a>
                                    </div>
                                </div>
                            </div>
                            <div class="jobCard__tags">
                                ${aTags}
                            </div>
                            <div class="jobCard__details__location">
                                ${locations}
                            </div>
                        </div>
                `;
            })

            $('.content--unpadded').html(text)
        })
        .fail(err=>{
            console.log(err)
        })
    }

</script>


</body>
</html>
